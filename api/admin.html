<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VA Decision API - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #111827;
            color: #f3f4f6;
            padding: 0;
            margin: 0;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: #1f2937;
            border-right: 1px solid #374151;
            padding: 20px;
            overflow-y: auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 30px;
            color: #f59e0b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-section {
            margin-bottom: 25px;
        }

        .nav-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #9ca3af;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .nav-item {
            padding: 12px 16px;
            margin: 4px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #d1d5db;
        }

        .nav-item:hover {
            background: #374151;
            color: #f3f4f6;
        }

        .nav-item.active {
            background: #3b82f6;
            color: white;
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(245, 158, 11, 0.3);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            color: white;
        }

        .subtitle {
            color: #fef3c7;
            font-size: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 15px;
        }

        .badge.admin {
            background: #dc2626;
            color: white;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1f2937;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #374151;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #f3f4f6;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 0.85rem;
            color: #10b981;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .card {
            background: #1f2937;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #374151;
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #f3f4f6;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #111827;
            padding: 12px;
            text-align: left;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #9ca3af;
            border-bottom: 2px solid #374151;
        }

        td {
            padding: 16px 12px;
            border-bottom: 1px solid #374151;
            color: #d1d5db;
        }

        tr:hover {
            background: #111827;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #d1d5db;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #374151;
            background: #111827;
            color: #f3f4f6;
            font-size: 0.95rem;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        textarea {
            min-height: 120px;
            font-family: 'Courier New', monospace;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            flex: 1;
            max-width: 400px;
        }

        .search-box input {
            width: 100%;
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-granted {
            background: #065f46;
            color: #d1fae5;
        }

        .status-denied {
            background: #991b1b;
            color: #fecaca;
        }

        .status-remanded {
            background: #92400e;
            color: #fed7aa;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #374151;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #9ca3af;
            cursor: pointer;
        }

        .modal-close:hover {
            color: #f3f4f6;
        }

        /* Log viewer */
        .log-viewer {
            background: #111827;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #374151;
        }

        .log-entry {
            padding: 6px;
            margin: 2px 0;
        }

        /* Charts container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Alert */
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #1e40af;
            color: #bfdbfe;
            border-left: 4px solid #3b82f6;
        }

        .alert-warning {
            background: #92400e;
            color: #fed7aa;
            border-left: 4px solid #f59e0b;
        }

        .alert-danger {
            background: #991b1b;
            color: #fecaca;
            border-left: 4px solid #dc2626;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
        }

        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="logo">
            <span>‚öôÔ∏è</span> Admin Panel
        </div>

        <div class="nav-section">
            <div class="nav-label">Overview</div>
            <div class="nav-item active" onclick="showSection('dashboard')">
                <span class="nav-icon">üìä</span> Dashboard
            </div>
            <div class="nav-item" onclick="showSection('metrics')">
                <span class="nav-icon">üìà</span> Metrics
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-label">Data Management</div>
            <div class="nav-item" onclick="showSection('decisions')">
                <span class="nav-icon">üìÑ</span> Decisions
            </div>
            <div class="nav-item" onclick="showSection('import')">
                <span class="nav-icon">üì•</span> Import Data
            </div>
            <div class="nav-item" onclick="showSection('export')">
                <span class="nav-icon">üì§</span> Export Data
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-label">System</div>
            <div class="nav-item" onclick="showSection('logs')">
                <span class="nav-icon">üìù</span> System Logs
            </div>
            <div class="nav-item" onclick="showSection('database')">
                <span class="nav-icon">üíæ</span> Database
            </div>
            <div class="nav-item" onclick="showSection('config')">
                <span class="nav-icon">‚öôÔ∏è</span> Configuration
            </div>
        </div>

        <div class="nav-section">
            <div class="nav-label">Tools</div>
            <div class="nav-item" onclick="showSection('api-tester')">
                <span class="nav-icon">üîß</span> API Tester
            </div>
            <div class="nav-item" onclick="window.open('/dashboard', '_blank')">
                <span class="nav-icon">üìä</span> Dev Dashboard
            </div>
            <div class="nav-item" onclick="window.open('/docs', '_blank')">
                <span class="nav-icon">üìö</span> API Docs
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <h1>üõ°Ô∏è Admin Dashboard</h1>
            <p class="subtitle">System management and data administration</p>
            <span class="badge admin">ADMIN ACCESS</span>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Decisions</div>
                    <div class="stat-value" id="total-decisions">0</div>
                    <div class="stat-change">+0 this week</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Database Size</div>
                    <div class="stat-value" id="db-size">-- MB</div>
                    <div class="stat-change">PostgreSQL + pgvector</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">API Calls (24h)</div>
                    <div class="stat-value" id="api-calls">0</div>
                    <div class="stat-change" id="api-change">--</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">System Uptime</div>
                    <div class="stat-value" id="uptime">--</div>
                    <div class="stat-change">Healthy</div>
                </div>
            </div>

            <div class="card">
                <h2>üìã Recent Activity</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Action</th>
                            <th>User</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="activity-log">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #6b7280;">No recent activity</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>‚ö° Quick Actions</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showSection('import')">
                        üì• Import Decisions
                    </button>
                    <button class="btn btn-success" onclick="runQuery()">
                        üîç Run Test Query
                    </button>
                    <button class="btn btn-secondary" onclick="showSection('database')">
                        üíæ Check Database
                    </button>
                    <button class="btn btn-secondary" onclick="refreshDashboard()">
                        üîÑ Refresh Stats
                    </button>
                </div>
            </div>
        </div>

        <!-- Metrics Section -->
        <div id="metrics" class="content-section">
            <div class="card">
                <h2>üìà System Metrics</h2>
                <div id="metrics-content">
                    <p style="color: #6b7280;">Loading metrics...</p>
                </div>
            </div>
        </div>

        <!-- Decisions Section -->
        <div id="decisions" class="content-section">
            <div class="action-bar">
                <h2 style="margin: 0;">üìÑ Decision Management</h2>
                <div class="search-box">
                    <input type="text" placeholder="Search decisions..." id="decision-search">
                </div>
                <button class="btn btn-primary" onclick="showAddDecisionModal()">
                    + Add Decision
                </button>
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Case Number</th>
                            <th>Date</th>
                            <th>Outcome</th>
                            <th>Issues</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="decisions-table">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #6b7280;">No decisions loaded</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Import Section -->
        <div id="import" class="content-section">
            <div class="card">
                <h2>üì• Import Decisions</h2>

                <div class="alert alert-info">
                    <strong>Info:</strong> Import decisions from USA.gov search or manual entry.
                </div>

                <div class="form-group">
                    <label>Search Query</label>
                    <input type="text" id="import-query" placeholder="e.g., tinnitus granted">
                </div>

                <div class="form-group">
                    <label>Year</label>
                    <select id="import-year">
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Max Results</label>
                    <input type="number" id="import-count" value="10" min="1" max="100">
                </div>

                <button class="btn btn-primary" onclick="searchAndImport()">
                    üîç Search & Preview
                </button>

                <div id="import-results" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Export Section -->
        <div id="export" class="content-section">
            <div class="card">
                <h2>üì§ Export Data</h2>

                <div class="form-group">
                    <label>Export Format</label>
                    <select id="export-format">
                        <option value="json">JSON</option>
                        <option value="csv">CSV</option>
                        <option value="sql">SQL Dump</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Data Selection</label>
                    <select id="export-selection">
                        <option value="all">All Decisions</option>
                        <option value="granted">Granted Only</option>
                        <option value="denied">Denied Only</option>
                        <option value="remanded">Remanded Only</option>
                    </select>
                </div>

                <button class="btn btn-success" onclick="exportData()">
                    üì• Download Export
                </button>
            </div>
        </div>

        <!-- Logs Section -->
        <div id="logs" class="content-section">
            <div class="card">
                <h2>üìù System Logs</h2>
                <div class="action-bar">
                    <select id="log-level">
                        <option value="all">All Levels</option>
                        <option value="error">Errors Only</option>
                        <option value="warning">Warnings Only</option>
                        <option value="info">Info Only</option>
                    </select>
                    <button class="btn btn-secondary" onclick="refreshLogs()">
                        üîÑ Refresh Logs
                    </button>
                </div>
                <div class="log-viewer" id="log-viewer">
                    <div class="log-entry">Waiting for log data...</div>
                </div>
            </div>
        </div>

        <!-- Database Section -->
        <div id="database" class="content-section">
            <div class="card">
                <h2>üíæ Database Status</h2>
                <div id="db-status">
                    <p style="color: #6b7280;">Checking database connection...</p>
                </div>
            </div>

            <div class="card">
                <h2>üóÑÔ∏è Tables</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Table Name</th>
                            <th>Row Count</th>
                            <th>Size</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tables-list">
                        <tr>
                            <td colspan="4" style="text-align: center; color: #6b7280;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Config Section -->
        <div id="config" class="content-section">
            <div class="card">
                <h2>‚öôÔ∏è System Configuration</h2>

                <div class="alert alert-warning">
                    <strong>Warning:</strong> Modifying configuration requires system restart.
                </div>

                <div class="form-group">
                    <label>Gemini API Key</label>
                    <input type="password" id="config-gemini-key" placeholder="your-key-here">
                </div>

                <div class="form-group">
                    <label>PostgreSQL Host</label>
                    <input type="text" id="config-db-host" value="localhost">
                </div>

                <div class="form-group">
                    <label>PostgreSQL Port</label>
                    <input type="number" id="config-db-port" value="5432">
                </div>

                <div class="form-group">
                    <label>Database Name</label>
                    <input type="text" id="config-db-name" value="va_decisions">
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">
                    üíæ Save Configuration
                </button>
                <button class="btn btn-secondary" onclick="loadConfig()">
                    üîÑ Reload from .env
                </button>
            </div>
        </div>

        <!-- API Tester Section -->
        <div id="api-tester" class="content-section">
            <div class="card">
                <h2>üîß API Endpoint Tester</h2>

                <div class="form-group">
                    <label>Endpoint</label>
                    <select id="test-endpoint">
                        <option value="/health">GET /health</option>
                        <option value="/metrics">GET /metrics</option>
                        <option value="/api/v1/search">POST /api/v1/search</option>
                        <option value="/api/v1/decision/{id}">GET /api/v1/decision/{id}</option>
                        <option value="/api/v1/extract">POST /api/v1/extract</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Request Body (JSON)</label>
                    <textarea id="test-body" placeholder='{"query": "tinnitus", "year": 2024}'></textarea>
                </div>

                <button class="btn btn-primary" onclick="testEndpoint()">
                    üöÄ Send Request
                </button>

                <div class="form-group" style="margin-top: 20px;">
                    <label>Response</label>
                    <div class="log-viewer" id="test-response">
                        <div style="color: #6b7280;">Response will appear here...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Decision Modal -->
    <div id="addDecisionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Decision</h2>
                <button class="modal-close" onclick="closeModal('addDecisionModal')">&times;</button>
            </div>

            <div class="form-group">
                <label>Case Number</label>
                <input type="text" id="new-case-number" placeholder="A24084938">
            </div>

            <div class="form-group">
                <label>Year</label>
                <input type="number" id="new-year" value="2024">
            </div>

            <button class="btn btn-primary" onclick="addDecision()">
                Add Decision
            </button>
        </div>
    </div>

    <script>
        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Set active nav item
            event.target.closest('.nav-item').classList.add('active');

            // Load section data
            if (sectionId === 'metrics') {
                loadMetrics();
            } else if (sectionId === 'logs') {
                refreshLogs();
            } else if (sectionId === 'database') {
                checkDatabase();
            }
        }

        // Dashboard functions
        async function refreshDashboard() {
            try {
                const response = await fetch('/metrics');
                const data = await response.json();

                document.getElementById('api-calls').textContent = data.latency?.count || 0;
                document.getElementById('total-decisions').textContent = '20'; // Mock for now

                const change = ((data.latency?.count || 0) > 10) ? '+' : '';
                document.getElementById('api-change').textContent = change + (data.latency?.count || 0);
            } catch (error) {
                console.error('Failed to refresh dashboard:', error);
            }
        }

        // Metrics
        async function loadMetrics() {
            try {
                const response = await fetch('/metrics');
                const data = await response.json();

                const html = `
                    <pre style="background: #111827; padding: 20px; border-radius: 8px; overflow-x: auto;">
${JSON.stringify(data, null, 2)}
                    </pre>
                `;

                document.getElementById('metrics-content').innerHTML = html;
            } catch (error) {
                document.getElementById('metrics-content').innerHTML =
                    '<p style="color: #ef4444;">Failed to load metrics</p>';
            }
        }

        // Import
        async function searchAndImport() {
            const query = document.getElementById('import-query').value;
            const year = document.getElementById('import-year').value;
            const count = document.getElementById('import-count').value;

            if (!query) {
                alert('Please enter a search query');
                return;
            }

            const resultsDiv = document.getElementById('import-results');
            resultsDiv.innerHTML = '<p style="color: #6b7280;">Searching...</p>';

            try {
                const response = await fetch('/api/v1/search', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        query: query,
                        year: parseInt(year),
                        max_results: parseInt(count)
                    })
                });

                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    let html = `<div class="alert alert-info">Found ${data.count} decisions</div>`;
                    html += '<table><thead><tr><th>Case Number</th><th>Year</th><th>Actions</th></tr></thead><tbody>';

                    data.results.forEach(result => {
                        html += `
                            <tr>
                                <td>${result.case_number}</td>
                                <td>${result.year}</td>
                                <td>
                                    <button class="btn btn-primary" onclick="ingestDecision('${result.case_number}', ${result.year})">
                                        Import
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p style="color: #6b7280;">No results found</p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<p style="color: #ef4444;">Search failed: ' + error.message + '</p>';
            }
        }

        async function ingestDecision(caseNumber, year) {
            try {
                const response = await fetch('/api/v1/ingest', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        case_number: caseNumber,
                        year: year
                    })
                });

                const data = await response.json();
                alert(`Decision ${caseNumber} imported successfully!`);
                refreshDashboard();
            } catch (error) {
                alert('Import failed: ' + error.message);
            }
        }

        // Export
        function exportData() {
            const format = document.getElementById('export-format').value;
            const selection = document.getElementById('export-selection').value;

            alert(`Export feature coming soon!\nFormat: ${format}\nSelection: ${selection}`);
        }

        // Logs
        async function refreshLogs() {
            const viewer = document.getElementById('log-viewer');
            viewer.innerHTML = '<div class="log-entry">Mock log entry - integration pending</div>';
        }

        // Database
        async function checkDatabase() {
            const statusDiv = document.getElementById('db-status');
            const tablesDiv = document.getElementById('tables-list');

            statusDiv.innerHTML = `
                <p style="color: #10b981;">‚úì Connected to PostgreSQL</p>
                <p style="color: #6b7280;">Host: localhost:5432</p>
                <p style="color: #6b7280;">Database: va_decisions</p>
            `;

            tablesDiv.innerHTML = `
                <tr>
                    <td>decisions</td>
                    <td>20</td>
                    <td>2.4 MB</td>
                    <td><button class="btn btn-secondary">View</button></td>
                </tr>
                <tr>
                    <td>issues</td>
                    <td>45</td>
                    <td>1.2 MB</td>
                    <td><button class="btn btn-secondary">View</button></td>
                </tr>
            `;
        }

        // Config
        function saveConfig() {
            alert('Configuration saved! Restart server to apply changes.');
        }

        function loadConfig() {
            alert('Configuration reloaded from .env');
        }

        // API Tester
        async function testEndpoint() {
            const endpoint = document.getElementById('test-endpoint').value;
            const body = document.getElementById('test-body').value;
            const responseDiv = document.getElementById('test-response');

            responseDiv.innerHTML = '<div style="color: #6b7280;">Sending request...</div>';

            try {
                const options = {
                    method: endpoint.startsWith('POST') ? 'POST' : 'GET',
                    headers: {'Content-Type': 'application/json'}
                };

                if (options.method === 'POST' && body) {
                    options.body = body;
                }

                const url = endpoint.replace('{id}', 'A24084938') + (endpoint.includes('decision') ? '?year=2024' : '');
                const response = await fetch(url, options);
                const data = await response.json();

                responseDiv.innerHTML = `
                    <div style="color: #10b981;">Status: ${response.status} ${response.statusText}</div>
                    <pre style="margin-top: 10px;">${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                responseDiv.innerHTML = `<div style="color: #ef4444;">Error: ${error.message}</div>`;
            }
        }

        // Modals
        function showAddDecisionModal() {
            document.getElementById('addDecisionModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function addDecision() {
            const caseNumber = document.getElementById('new-case-number').value;
            const year = document.getElementById('new-year').value;

            if (caseNumber && year) {
                ingestDecision(caseNumber, parseInt(year));
                closeModal('addDecisionModal');
            } else {
                alert('Please fill in all fields');
            }
        }

        // Utility
        function runQuery() {
            alert('Running test query...\nThis will execute a sample similarity search.');
        }

        // Initialize
        refreshDashboard();
        setInterval(refreshDashboard, 5000);
    </script>
</body>
</html>
